# 04 游戏引擎的渲染实践

![image-20250929193925878](assets/image-20250929193925878.png)

![image-20250929194102466](assets/image-20250929194102466.png)

![image-20250929194235793](assets/image-20250929194235793.png)

![image-20250929194344148](assets/image-20250929194344148.png)

![image-20250929194447771](assets/image-20250929194447771.png)

![image-20250929194624234](assets/image-20250929194624234.png)

![image-20250929194754806](assets/image-20250929194754806.png)

## 渲染概述

![image-20250929194929441](assets/image-20250929194929441.png)

![image-20250929195433711](assets/image-20250929195433711.png)

![image-20250929195654814](assets/image-20250929195654814.png)

![image-20250929195738406](assets/image-20250929195738406.png)

## GPU

The dedicated hardware to solve massive jobs.

![image-20250929200123413](assets/image-20250929200123413.png)

SIMD：单指令，多数据

SIMT：单指令，多线程

![image-20250929200422615](assets/image-20250929200422615.png)

![image-20250929200708900](assets/image-20250929200708900.png)

CPU在读取数据方面是相对比较慢的

尽量只进行单向数据传输，不要传来传去

![image-20250929200937790](assets/image-20250929200937790.png)

在内存中找数据其实是很慢的



![image-20250929201047098](assets/image-20250929201047098.png)

![image-20250929201155639](assets/image-20250929201155639.png)

![image-20250929201238296](assets/image-20250929201238296.png)



## Renderable Things

![image-20250929212119707](assets/image-20250929212119707.png)

![image-20250929212417079](assets/image-20250929212417079.png)

![image-20250929212520049](assets/image-20250929212520049.png)

这种方式其实比较笨，因为很多三角形很容易共用一个顶点，就会导致Triangle对象中的Vertex有冗余



更聪明的办法：

![image-20250929212629871](assets/image-20250929212629871.png)

甚至不用Index Buffer，想办法把模型变成可以一笔画的顺序，这样顶点就可以通过顺序存储来定义三角形

![image-20250929213006548](assets/image-20250929213006548.png)

每个顶点都要单独定义法向

![image-20250929213034800](assets/image-20250929213034800.png)

![image-20250929213128004](assets/image-20250929213128004.png)

![image-20250929213156173](assets/image-20250929213156173.png)

![image-20250929213242022](assets/image-20250929213242022.png)

Shader既是代码，也是资产



## Render

![image-20250929213514047](assets/image-20250929213514047.png)

![image-20250929213534903](assets/image-20250929213534903.png)

![image-20250929213622943](assets/image-20250929213622943.png)

Submesh

不同的部分需要分开处理材质、纹理、shader，但模型的所有顶点可以存储在一起，只需要为index buffer给定一个offest来确定哪个部位的顶点在哪开始



![image-20250929213847421](assets/image-20250929213847421.png)

很多模型可能会共用相同的资产，如果一人一份的话，就会浪费内存

![image-20250929213939629](assets/image-20250929213939629.png)

![image-20250929214012201](assets/image-20250929214012201.png)

用“池”来管理可复用的资源

值得注意的是，资产和使用到资产的GO实际上是“定义”，而游戏场景中出现的是“实例化”后的“定义”

![image-20250929214305341](assets/image-20250929214305341.png)

如果每个模型都逐一渲染，先渲染完一个再渲染一个的话，就会很容易发生渲染时用到的材质、纹理、shader的改变，这个时候就又要重新读这些数据，而我们知道重新在内存中读数据是比较慢的，那不如就按照相同的材质分类渲染



![image-20250929214551341](assets/image-20250929214551341.png)



#### 可见性裁切

摄像机视锥之外的模型没有必要管7

![image-20250929214719473](assets/image-20250929214719473.png)

![image-20250929214752924](assets/image-20250929214752924.png)

![image-20250929214929351](assets/image-20250929214929351.png)

层次化查询可见性

![image-20250929215036396](assets/image-20250929215036396.png)

![image-20250929215107720](assets/image-20250929215107720.png)

![image-20250929215223667](assets/image-20250929215223667.png)

![image-20250929215311617](assets/image-20250929215311617.png)

PVS的思想不仅可以用于可见性裁切，还可以应用到资源加载中

![image-20250929215447171](assets/image-20250929215447171.png)



### 纹理压缩

![image-20250929215744281](assets/image-20250929215744281.png)

![image-20250929215903977](assets/image-20250929215903977.png)



### 建模

![image-20250929220353218](assets/image-20250929220353218.png)



### 以集群为基础的网格管线

![image-20250930090144315](assets/image-20250930090144315.png)

![image-20250930090240118](assets/image-20250930090240118.png)

把若干三角形集结在一起一次性去交给GPU计算

![image-20250930090433340](assets/image-20250930090433340.png)

![image-20250930090648696](assets/image-20250930090648696.png)

![image-20250930090849148](assets/image-20250930090849148.png)



## Rendering in Game Engine

![image-20250930093327320](assets/image-20250930093327320.png)

![image-20250930093356208](assets/image-20250930093356208.png)

![image-20250930093710447](assets/image-20250930093710447.png)

**The 1st Challenge**

![image-20250930095716350](assets/image-20250930095716350.png)

![image-20250930095914320](assets/image-20250930095914320.png)

**The 2nd Challenge**

![image-20250930100129395](assets/image-20250930100129395.png)

**The 3rd Challenge**

![image-20250930100242860](assets/image-20250930100242860.png)

![image-20250930100345819](assets/image-20250930100345819.png)



### Start from simple !

![image-20250930100748633](assets/image-20250930100748633.png)

![image-20250930100923922](assets/image-20250930100923922.png)

![image-20250930101008301](assets/image-20250930101008301.png)

![image-20250930101222774](assets/image-20250930101222774.png)

![image-20250930101407600](assets/image-20250930101407600.png)

![image-20250930101717876](assets/image-20250930101717876.png)

![image-20250930101940278](assets/image-20250930101940278.png)

![image-20250930102207598](assets/image-20250930102207598.png)

![image-20250930102316763](assets/image-20250930102316763.png)





![image-20250930102435763](assets/image-20250930102435763.png)



### Pre-computed Global ILLmination

![image-20250930102737949](assets/image-20250930102737949.png)

![image-20250930102834023](assets/image-20250930102834023.png)

![image-20250930151858330](assets/image-20250930151858330.png)

![image-20250930152115195](assets/image-20250930152115195.png)

![image-20250930152230505](assets/image-20250930152230505.png)

![image-20250930152343540](assets/image-20250930152343540.png)

![image-20250930152430498](assets/image-20250930152430498.png)

![image-20250930152730581](assets/image-20250930152730581.png)

![image-20250930152853180](assets/image-20250930152853180.png)

![image-20250930153014969](assets/image-20250930153014969.png)

![image-20250930153112485](assets/image-20250930153112485.png)

![image-20250930153120140](assets/image-20250930153120140.png)

![image-20250930153154801](assets/image-20250930153154801.png)