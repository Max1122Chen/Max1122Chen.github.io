# 虚幻2D游戏

### 虚幻2D项目必要的设置

1. 自动曝光Auto Exposure：

   模拟人眼从明亮的地方进入黑暗后适应黑暗时环境光照的变化

   关闭自动曝光，并把自动曝光设置成手动，自动曝光偏移设置为0

2. 运动模糊Motion Blur：

   对2D游戏并不太好，关闭

3. 抗锯齿Anti Aliasing：

   纯像素2D游戏需要关闭

4. 动态全局照明Dynamic global illumination：

   默认是Lumen，对2D游戏来说大炮打蚊子，换掉

5. 反射方式Reflection Method：

   默认也是Lumen，换掉

6. 阴影贴图Shadow Maps：

   默认是虚拟阴影贴图，改成”Shadow Maps“

7. 环境光遮蔽Ambient Occlusion：

   不需要，关掉

8. 前向着色Forward Shading：

   需要开启

9. 后处理体积的使用：

   把一个后处理体积拖进世界，并归零坐标，把”后处理体积设置“中的”无限延申“勾选，使得它对全局生效

   搜索ev100，开启”Max EV100“和”Min EV100"并归零

   搜索vignette晕影强度，这会在边缘产生晕影，先勾选，然后拉到0.

   搜索expand gamut扩展色域，选上并拖到0

   搜索tone curve amount，选上并拖到0

10. 纹理资产：

    在纹理资产中搜索Filter，改成nearest

    批量操作可以在内容浏览器中过滤出texture然后用属性矩阵改

### 2D资产导入与比例

​	导入图片时，可能会发现图片非常模糊，此时可以右键图片选择把它“应用为Paper2D纹理设置”

​	需要让导入的纹理图片能够被放置在世界中的话，需要右键把已经执行了上一步的图片转换成2D精灵（sprite）

​	32*32的tile的合适设置是0.32unit per pixel

​	使用等距tilemap时，对32*32的单元tile，x=16，y=8的偏移量正好

### 创建2D世界

#### 创建世界的底色：Tile Set

​	2D世界的“地面”是一种叫做“Tile Set”的资产类型，右键纹理图片可转换。Tile Set相当于一个调色板，可以被用来绘制图块地图。

​	需要把Tile Size调整到合适的大小。

​	直接使用Tile Set有时会在Tile Map上产生裂缝，需要对Tile Set做条件设置，只需右键Tile Set资产，选择Condition Tile Sheet Texture

#### 为Tile添加碰撞（可选）

​	Tile编辑界面上方工具栏中“Add Box”可为Tile添加碰撞，打开“Colliding Tiles”可检查哪些Tile加了碰撞。

​	但是，过多的单独的碰撞箱会导致性能下降，所以一般不通过给所有的地面Tile加单独的碰撞箱来给地面加碰撞体积，而是使用额外的其他的碰撞体积。

#### 使用创建好的Tile Set绘制Tile Map并使用

​	在内容浏览器中添加一个”Tile Map"资产，在它上面就可以用创建好的Tile Set进行绘制。选取Tile Set的一个Tile，就可以开始绘制地图看。

​	 Tile Map可以分层。



**把Tile Map导入关卡并使用**：导入后，应当让Tile Map面朝上，这样才能正常使用ue的导航网格



### 创建动态的2D资产by FlipBook

​	首先可能需要先把完整的texture分割开来，这时需要右键texture选择提取sprite，一般不会选择自动分割，而是手动设置分割单元大小。

#### 创建Flipbook

​	复选好要创建Flipbook的sprite，右键创建。

​	需要创建成动画的资产都要创建成Flipbook.

​	选择多个要编辑的Flipbook，选择“在属性矩阵中设置选项”，可以一次性编辑多个Flipbook。

​	对于有动态的物体来说，我们在游戏里使用的都是Flipbook而不是单独的分离的帧。

​	Flipbook可以被直接拖进世界里并且播放



### 使用PaperZD插件更好地创建2D动画

​	首先要创建动画源，存储要使用的动画

​	动画源中可以为角色设定逻辑上的方向，来方便转换动画状态，角色被认为是哪个方向，就播放哪个方向上的动画。

​	再根据动画源创建PaperZD动画蓝图

​	PaperZD动画蓝图可以调用“Set Directionality”来设置角色的逻辑方向，可以通过玩家的速度分量来确定方向

​	

### 创建2D角色

​	从PaperCharacter派生2D角色，PaperCharacter比Character多一个Paper Flipbook Component。

​	如果要使用PaperZD的动画功能，需要派生自PaperZDCharacter

​	正确的改变PaperCharacter中角色贴图发大小是在角色的“帧”中改变“Pixel per unit”，在虚幻引擎中，一个单位是1cm。

​	由于角色的运动组件有很多默认的设置，这些内容改起来可能比放大角色麻烦得多，所以我们选择改角色，同时也要把地图的“Pixel per unit”改成和角色一样

##### 角色的最大步高：

Character的MovementComponent中的“最大步高”可以控制角色最大能够迈过的高度



### Sprite的分层

1. 首先改变场景物体Sprite的中心点的位置，可以选择设置在Sprite的游戏中的“下方中间”（bottom center）

2. **允许角色移动到场景物体后方**：可以在场景物体Sprite的编辑界面直接“编辑碰撞“改变碰撞箱的范围，把碰撞箱改到场景物体Sprite的一半以下

3. 对玩家和场景物体的Sprite都使用”半透明不发光材质“，并在项目设置中把Translucency中的Translucency Sort Policy改成”Sort by Axis“并确保Y轴上的值是-1.0

4. Sprite应用在角色蓝图中会导致材质被覆写，要在角色蓝图中同样为角色设置半透明不发光材质

   类似地，FlipBook也会覆写材质，也要改

### 2D游戏的简单UI

​	使用border时，border中承载的2D像素图画可能会有拉伸，需要把”Draw As“改成box并修改边距。在Border中使用TextBox时，字数太多可能会导致超出边界，可以在TextBox中更改”Wrapping“，勾选”Auto Wrap Text“

## 2D游戏实际开发

### 对象池的创建与管理

​	使用GameInstance管理对象池