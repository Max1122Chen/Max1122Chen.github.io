# 虚幻5骨骼网格体动画系统

## 动画资产

​	动画管线可分为两类资产，**内容资产**通常从外部导入，包括骨架，骨骼网格体，动画序列等；**控制资产**帮助我们处理这些内容资产，帮助我们计算出最终姿势，它们包括动画蓝图、控制绑定（Control Rig）等。



















### 骨骼网格体动画的基础

虚幻引擎中的角色动画基于 **骨架网格体（Skeletal Mesh）** 实现。骨架网格体是一种绑定了骨骼的模型，可用于创建动画。此外，你可以用  **动画蓝图（Animation Blueprints）** 为骨架网格体添加逻辑，以便角色和场景互动。

### Mixamo动画导入UE

正常导入资源后，对要转换的动画序列选择“重定向动画”，选择想要的目标网格体和动画序列，可以选择直接导出成动画

### 动画蓝图

​	动画定义了播放动画的逻辑，比起使用单纯的一个“动画”，动画蓝图可以依据用户定义的情形使用多种播放动画的策略

### 混合空间

​	混合空间可以基于某种条件“混合”其中配置的动画，混合空间（2D新版）可以接受两个参数，在该参数变化的时候将各种动画实现平滑的过渡。

### 动画蓝图的使用逻辑：

​	动画蓝图中可以定义事件逻辑，对于一些静态事物，例如树，如果不要求其“感受”环境的改变，那么它需要的一个简单的动画就是树叶自然地飘动。但是对于更活泼的事物，例如角色，则需要在角色进行不同的逻辑行为时给它播放相应的动作行为。那么问题就是如何让动画蓝图“感知”到角色的行为？

​	首先，很自然的一点，我们需要让动画蓝图在被初始化时获取到Actor的引用，并将其cast to一个合适的类型，例如获取到的Actor是一个Character同时要给他运动的逻辑，那么需要将其cast to Pawn或Character，才能使用它的运动组件。且我们最好把这个引用赋值给一个变量，方便后续使用。同上，Actor的运动组件也是需要的。对于我们有需要多次使用的引用，自然把其存储起来，后续不再赘述。

![image-20241023163858646](C:\Users\Max1122Chen\AppData\Roaming\Typora\typora-user-images\image-20241023163858646.png)

上图为UE5第三人称角色动画蓝图中定义的变量。



#### 动画插槽的使用

​	为角色创建复杂的动画时，可能需要在动画蓝图中创建代理区域用来插入一次性的动画。为此可以使用 **插槽（Slots）**，这是一种可以添加至动画蓝图各处的节点，用于叠加并播放动画。插槽通常和[动画蒙太奇](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/animation-montage-in-unreal-engine)一起使用，但也可以与[Sequencer](https://dev.epicgames.com/documentation/zh-cn/unreal-engine/cinematics-and-movie-making-in-unreal-engine)一起使用。

​	插槽为动画蓝图提供了一些可以“插入”“插队”的位置，使得插槽所在的位置可以被插入动画。

**动画蒙太奇：**“蒙太奇”其实就是“剪辑”，动画蒙太奇指把动画序列剪辑或拼接起来的一个动画片段。

​	注意：使用动画蒙太奇必须给予角色一个动画插槽。因为一个单独的动画蒙太奇不是一个定义好的动画播放事件，换言之，直接在某个地方执行播放动画蒙太奇而没有给予插槽，引擎不会理会你。

​	使用动画蒙太奇需要指定执行的骨骼，所以使用动画蒙太奇时需要考虑一下在谁的蓝图上布置。

##### 不同部位的插槽

### 状态机

​	**状态机（State Machines）** 是一种可以在 **动画蓝图** 中构建的模块化系统，用来定义动画的播放状态和播放时机。这类系统主要用于将动画与角色的动作状态相关联，例如空闲、行走、奔跑和跳跃等状态。借助状态机，你可以创建各种 **状态（State）** ，定义要在这些状态中播放的动画，并创建各类 **转换（Transition）** 来控制何时切换到其他状态。这样，你就能更轻松地创建出复杂的动画混合效果，而不必使用过于复杂的动画图表。

​	实际上，在动画蓝图中设置一系列表示状态的变量，并用一些判断逻辑判断应该执行哪些状态下的逻辑与使用状态机是一样的。但使用状态机无疑可以增加动画蓝图的可读性，并使得其逻辑一目了然。

#### 状态机的使用：

​	状态机始于“entry”，为状态机的默认状态，它通常设置为角色的“空闲”(idle)状态。

##### 创建状态

​	“状态”本身包含了动画图表，并可以添加动画逻辑。打开一个状态机内部以添加新状态。

**状态别名**：状态别名常用于优化状态机图表，它可以绑定到一些原有的状态，并使得它们可以像其自己那样向其他状态“转换”。下图是一个**状态别名**的例子。

![image-20241023211800384](C:\Users\Max1122Chen\AppData\Roaming\Typora\typora-user-images\image-20241023211800384.png)

![image-20241023211827994](C:\Users\Max1122Chen\AppData\Roaming\Typora\typora-user-images\image-20241023211827994.png)![image-20241023211844218](C:\Users\Max1122Chen\AppData\Roaming\Typora\typora-user-images\image-20241023211844218.png)







#### 动画通知

在动画蒙太奇的轨道中有一个“通知轨道”，可以为它添加通知事件，使得动画蒙太奇在播放到有通知的地方时，可以通知动画蓝图去执行某些逻辑。

